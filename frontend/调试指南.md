# 🔧 前端订票功能调试指南

## 问题描述
点击"立即订票"按钮后没有发送HTTP请求

## 🔍 调试步骤

### 1. 检查浏览器控制台
打开浏览器开发者工具（F12），切换到Console选项卡，然后：

1. **点击测试按钮**: 先点击红色的"测试API调用"按钮
2. **查看控制台输出**: 应该看到类似以下日志：
   ```
   开始测试API调用
   测试数据: {userId: 479887545757470720, flightNumber: "CA1234"}
   发送订单请求到: /orders/with-seat-allocation
   请求数据: {userId: 479887545757470720, flightNumber: "CA1234"}
   ```

3. **检查网络请求**: 切换到Network选项卡，重新点击测试按钮，应该看到HTTP请求

### 2. 检查用户登录状态
在控制台中运行：
```javascript
localStorage.getItem('user')
```

如果返回`null`，说明用户未登录，需要先登录。

### 3. 检查后端服务状态
确认以下服务正在运行：
- **网关服务**: http://localhost:8080
- **订单服务**: http://localhost:8082  
- **库存服务**: http://localhost:8081

### 4. 手动测试API
在控制台中手动调用API：
```javascript
// 手动导入API函数
import('/src/api/order.js').then(module => {
  const { createOrderWithSeatAllocation } = module;
  return createOrderWithSeatAllocation({
    userId: 479887545757470720,
    flightNumber: 'CA1234'
  });
}).then(response => {
  console.log('API响应:', response);
}).catch(error => {
  console.error('API错误:', error);
});
```

## 🚨 常见问题及解决方案

### 问题1: 控制台没有任何输出
**可能原因**: 事件绑定失败
**解决方案**: 
1. 检查Vue组件是否正确加载
2. 确认方法名称拼写正确
3. 检查是否有JavaScript语法错误

### 问题2: 用户信息为空
**可能原因**: 用户未登录或localStorage被清除
**解决方案**:
1. 访问登录页面重新登录
2. 或在控制台手动设置用户信息：
```javascript
localStorage.setItem('user', JSON.stringify({
  userId: 479887545757470720,
  username: 'test'
}));
```

### 问题3: 网络请求被阻止
**可能原因**: CORS问题或代理配置错误
**解决方案**:
1. 检查vite.config.js中的代理配置
2. 确认后端服务启动并可访问
3. 检查网络连接

### 问题4: API返回错误
**可能原因**: 后端服务未启动或接口路径错误
**解决方案**:
1. 确认订单服务在8082端口运行
2. 检查接口路径是否正确: `/api/orders/with-seat-allocation`
3. 查看后端日志确认请求到达

## 🔧 修复代码

如果问题仍然存在，可以尝试以下修复：

### 修复1: 简化按钮绑定
```vue
<button @click="() => bookFlight(flight)">立即订票</button>
```

### 修复2: 添加防抖
```javascript
async bookFlight(flight) {
  if (this.isBooking) return;
  this.isBooking = true;
  
  try {
    // 原有代码...
  } finally {
    this.isBooking = false;
  }
}
```

### 修复3: 直接使用原生fetch
```javascript
async bookFlight(flight) {
  try {
    const response = await fetch('/api/orders/with-seat-allocation', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        userId: user.userId,
        flightNumber: flight.flightNumber
      })
    });
    const data = await response.json();
    console.log('订票响应:', data);
  } catch (error) {
    console.error('订票失败:', error);
  }
}
```

## 📝 调试清单

- [ ] 浏览器控制台无错误
- [ ] 用户已登录（localStorage中有user信息）
- [ ] 后端服务正常运行
- [ ] 网络请求能正常发出
- [ ] API响应正常返回
- [ ] Vue组件方法正确绑定

## 🆘 如果问题仍未解决

请提供以下信息：
1. 浏览器控制台的完整错误信息
2. Network面板中的请求详情
3. 后端服务的运行状态
4. 用户登录状态（localStorage内容）

通过这些信息可以进一步定位问题所在。
